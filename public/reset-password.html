<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Restablecer contraseña</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu;max-width:420px;margin:40px auto;padding:0 16px}
    form{display:grid;gap:12px}
    input,button{padding:10px;font-size:16px}
    .ok{color:#0a7a30}.err{color:#b00020}
  </style>
</head>
<body>
  <h1>Restablecer contraseña</h1>

  <form id="frm">
    <label>Nueva contraseña
      <input id="p1" type="password" minlength="6" required />
    </label>
    <label>Repetir contraseña
      <input id="p2" type="password" minlength="6" required />
    </label>
    <button type="submit">Guardar</button>
  </form>

  <p id="msg"></p>

  <script>
    const $ = (s)=>document.querySelector(s);
    const msg = $("#msg");
    const params = new URLSearchParams(location.search);
    const token = params.get("token");

    if(!token){
      msg.textContent = "Falta el token en la URL.";
      msg.className = "err";
      $("#frm").style.display = "none";
    }

    $("#frm").addEventListener("submit", async (e)=>{
      e.preventDefault();
      const p1 = $("#p1").value.trim();
      const p2 = $("#p2").value.trim();
      if(p1 !== p2){
        msg.textContent = "Las contraseñas no coinciden.";
        msg.className = "err";
        return;
      }

      try{
        // ajustá la ruta si tu endpoint es distinto
        const res = await fetch("/api/v1/auth/reset-password", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ token, contrasenia: p1 })
        });
        const data = await res.json();

        if(!res.ok || data.estado === false){
          msg.textContent = (data?.mensaje || "No se pudo restablecer la contraseña.");
          msg.className = "err";
        }else{
          msg.textContent = (data?.mensaje || "¡Contraseña actualizada con éxito!");
          msg.className = "ok";
          $("#frm").reset();
        }
      }catch(err){
        msg.textContent = "Error de red o del servidor.";
        msg.className = "err";
      }
    });
  </script>
</body>
</html>


